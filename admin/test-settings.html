<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings Test - Jekyll Admin</title>
    <link rel="stylesheet" href="assets/css/admin.css">
    <style>
        body {
            padding: 2rem;
            background-color: #f8f9fa;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-header {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>Settings Configuration Test</h1>
            <p>Jekyll Admin 사이트 설정 관리 기능 테스트</p>
            <button id="load-settings-btn" class="btn btn-primary">설정 로드 테스트</button>
            <button id="validate-test-btn" class="btn btn-outline">유효성 검사 테스트</button>
        </div>

        <div class="test-section">
            <h2>ConfigManager 테스트</h2>
            <div id="config-test-results">
                <p>테스트 결과가 여기에 표시됩니다...</p>
            </div>
        </div>

        <div class="test-section">
            <h2>설정 폼 테스트</h2>
            <div id="settings-form-container">
                <!-- Settings form will be rendered here -->
            </div>
        </div>
    </div>

    <script type="module">
        import { ConfigManager } from './assets/js/modules/config-manager.js';

        class SettingsTest {
            constructor() {
                this.configManager = new ConfigManager();
                this.init();
            }

            async init() {
                console.log('Settings test initialized');
                
                // Setup event listeners
                document.getElementById('load-settings-btn').addEventListener('click', () => {
                    this.testConfigLoad();
                });
                
                document.getElementById('validate-test-btn').addEventListener('click', () => {
                    this.testValidation();
                });

                // Run initial tests
                await this.runInitialTests();
            }

            async runInitialTests() {
                const resultsDiv = document.getElementById('config-test-results');
                
                try {
                    // Test ConfigManager instantiation
                    resultsDiv.innerHTML += '<p>✅ ConfigManager 인스턴스 생성 성공</p>';
                    
                    // Test default config
                    const defaultConfig = this.configManager.getConfig();
                    resultsDiv.innerHTML += `<p>✅ 기본 설정 로드: ${Object.keys(defaultConfig).length}개 필드</p>`;
                    
                    // Test validation
                    const validation = this.configManager.validateConfig(defaultConfig);
                    resultsDiv.innerHTML += `<p>✅ 유효성 검사: ${validation.isValid ? '통과' : '실패'}</p>`;
                    
                } catch (error) {
                    resultsDiv.innerHTML += `<p>❌ 테스트 실패: ${error.message}</p>`;
                }
            }

            async testConfigLoad() {
                const resultsDiv = document.getElementById('config-test-results');
                
                try {
                    resultsDiv.innerHTML += '<p>🔄 설정 로드 테스트 중...</p>';
                    
                    const config = await this.configManager.loadConfig();
                    resultsDiv.innerHTML += `<p>✅ 설정 로드 성공: ${JSON.stringify(config, null, 2)}</p>`;
                    
                } catch (error) {
                    resultsDiv.innerHTML += `<p>❌ 설정 로드 실패: ${error.message}</p>`;
                }
            }

            testValidation() {
                const resultsDiv = document.getElementById('config-test-results');
                
                // Test various validation scenarios
                const testCases = [
                    {
                        name: '유효한 설정',
                        config: {
                            title: 'Test Blog',
                            email: 'test@example.com',
                            description: 'A test blog',
                            url: 'https://test.github.io',
                            baseurl: '/blog'
                        }
                    },
                    {
                        name: '잘못된 이메일',
                        config: {
                            title: 'Test Blog',
                            email: 'invalid-email',
                            description: 'A test blog'
                        }
                    },
                    {
                        name: '잘못된 URL',
                        config: {
                            title: 'Test Blog',
                            email: 'test@example.com',
                            description: 'A test blog',
                            url: 'not-a-url'
                        }
                    },
                    {
                        name: '필수 필드 누락',
                        config: {
                            url: 'https://test.github.io'
                        }
                    }
                ];

                resultsDiv.innerHTML += '<h3>유효성 검사 테스트 결과:</h3>';
                
                testCases.forEach(testCase => {
                    const validation = this.configManager.validateConfig(testCase.config);
                    const status = validation.isValid ? '✅' : '❌';
                    
                    resultsDiv.innerHTML += `
                        <div style="margin: 1rem 0; padding: 1rem; border: 1px solid #ddd; border-radius: 4px;">
                            <h4>${status} ${testCase.name}</h4>
                            <p>유효성: ${validation.isValid ? '통과' : '실패'}</p>
                            ${validation.errors.length > 0 ? `<p>오류: ${validation.errors.join(', ')}</p>` : ''}
                            ${validation.warnings && validation.warnings.length > 0 ? `<p>경고: ${validation.warnings.join(', ')}</p>` : ''}
                        </div>
                    `;
                });
            }
        }

        // Initialize test when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new SettingsTest();
        });
    </script>
</body>
</html>